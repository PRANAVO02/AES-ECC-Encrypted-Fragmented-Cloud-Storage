<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SecureCloud | Hybrid Cloud Encryption</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3a0ca3;
      --success: #4cc9f0;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --light-gray: #e9ecef;
      --border-radius: 12px;
      --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--dark);
    }

    .container {
      max-width: 900px;
    }

    .app-card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .header h1 {
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .header p {
      color: var(--gray);
      font-size: 1.1rem;
    }

    .upload-area {
      border: 2px dashed var(--light-gray);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      transition: var(--transition);
      background-color: #fafbfc;
      margin-bottom: 1.5rem;
    }

    .upload-area:hover {
      border-color: var(--primary);
      background-color: #f0f5ff;
    }

    .upload-area i {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    .upload-area h4 {
      color: var(--dark);
      margin-bottom: 0.5rem;
    }

    .upload-area p {
      color: var(--gray);
      margin-bottom: 1.5rem;
    }

    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }

    .file-input-wrapper input[type=file] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .btn-primary {
      background-color: var(--primary);
      border-color: var(--primary);
      border-radius: 8px;
      padding: 0.6rem 1.5rem;
      font-weight: 600;
      transition: var(--transition);
    }

    .btn-primary:hover {
      background-color: var(--secondary);
      border-color: var(--secondary);
      transform: translateY(-2px);
    }

    .btn-success {
      background-color: var(--success);
      border-color: var(--success);
      border-radius: 8px;
      padding: 0.4rem 1rem;
      font-weight: 600;
      transition: var(--transition);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(76, 201, 240, 0.3);
    }

    .file-list {
      margin-top: 2rem;
    }

    .file-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-radius: var(--border-radius);
      background-color: white;
      margin-bottom: 1rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      transition: var(--transition);
      border-left: 4px solid var(--primary);
    }

    .file-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .file-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .file-icon {
      font-size: 1.5rem;
      color: var(--primary);
    }

    .file-name {
      font-weight: 600;
      color: var(--dark);
    }

    .file-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .spinner-overlay {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .spinner-overlay.active {
      display: flex;
    }

    .alert {
      border-radius: var(--border-radius);
      border: none;
      padding: 1rem 1.5rem;
    }

    .alert-info {
      background-color: #e3f2fd;
      color: var(--primary);
    }

    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--gray);
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1rem;
      color: var(--light-gray);
    }

    .empty-state h4 {
      margin-bottom: 0.5rem;
    }

    .security-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background-color: #e8f5e9;
      color: #2e7d32;
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-top: 0.5rem;
    }

    .footer {
      text-align: center;
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--light-gray);
      color: var(--gray);
      font-size: 0.9rem;
    }

    /* Encryption Animation Styles */
    .encryption-animation {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      background: linear-gradient(135deg, #f0f5ff 0%, #e3eeff 100%);
      border-radius: var(--border-radius);
      margin: 1.5rem 0;
      text-align: center;
    }

    .encryption-animation.active {
      display: flex;
    }

    .encryption-visual {
      position: relative;
      width: 200px;
      height: 120px;
      margin-bottom: 1.5rem;
    }

    .file-box {
      position: absolute;
      width: 60px;
      height: 80px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: var(--primary);
      transition: transform 0.5s ease;
      z-index: 2;
    }

    .file-box.left {
      left: 20px;
      top: 20px;
    }

    .file-box.right {
      right: 20px;
      top: 20px;
      background: var(--primary);
      color: white;
    }

    .encryption-process {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      display: flex;
      justify-content: space-between;
    }

    .encryption-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--primary);
      animation: encryptionFlow 1.5s infinite ease-in-out;
    }

    .encryption-dot:nth-child(1) {
      animation-delay: 0s;
    }

    .encryption-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .encryption-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes encryptionFlow {
      0%, 100% {
        transform: scale(1);
        opacity: 0.5;
      }
      50% {
        transform: scale(1.5);
        opacity: 1;
      }
    }

    .encryption-status {
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .encryption-progress {
      width: 100%;
      height: 6px;
      background: var(--light-gray);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 1rem;
    }

    .encryption-progress-bar {
      height: 100%;
      background: var(--primary);
      width: 0%;
      border-radius: 3px;
      transition: width 3s ease;
    }

    .encryption-steps {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 400px;
      margin-top: 1rem;
    }

    .encryption-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      flex: 1;
    }

    .step-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--light-gray);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gray);
      font-size: 1.2rem;
      transition: all 0.5s ease;
    }

    .step-icon.active {
      background: var(--primary);
      color: white;
    }

    .step-label {
      font-size: 0.8rem;
      color: var(--gray);
      text-align: center;
    }

    @media (max-width: 768px) {
      .app-card {
        padding: 1.5rem;
      }

      .file-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .file-actions {
        width: 100%;
        justify-content: flex-end;
      }

      .encryption-visual {
        width: 180px;
        height: 100px;
      }

      .file-box {
        width: 50px;
        height: 70px;
      }
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <!-- Header -->
    <div class="header">
      <h1><i class="fas fa-cloud-shield-alt me-2"></i>SecureCloud</h1>
      <p>Hybrid Cloud Storage with AES + ECC Encryption</p>
      <div class="security-badge">
        <i class="fas fa-lock"></i>
        <span>End-to-End Encrypted</span>
      </div>
    </div>

    <!-- Main App Card -->
    <div class="app-card">
      <!-- Upload Section -->
      <div class="upload-area" id="uploadArea">
        <i class="fas fa-cloud-upload-alt"></i>
        <h4>Upload & Encrypt Files</h4>
        <p>Drag & drop your files here or click to browse</p>
        <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
          <div class="file-input-wrapper">
            <button class="btn btn-primary" type="button">
              <i class="fas fa-folder-open me-2"></i>Choose File
            </button>
            <input type="file" name="file" id="fileInput" required>
          </div>
          <div class="mt-2" id="fileName"></div>
        </form>
      </div>

      <!-- Encryption Animation -->
      <div class="encryption-animation" id="encryptionAnimation">
        <div class="encryption-visual">
          <div class="file-box left">
            <i class="fas fa-file"></i>
          </div>
          <div class="encryption-process">
            <div class="encryption-dot"></div>
            <div class="encryption-dot"></div>
            <div class="encryption-dot"></div>
          </div>
          <div class="file-box right">
            <i class="fas fa-lock"></i>
          </div>
        </div>

        <div class="encryption-status" id="encryptionStatus">Initializing encryption...</div>

        <div class="encryption-progress">
          <div class="encryption-progress-bar" id="encryptionProgressBar"></div>
        </div>

        <div class="encryption-steps">
          <div class="encryption-step">
            <div class="step-icon" id="step1">
              <i class="fas fa-upload"></i>
            </div>
            <div class="step-label">Uploading</div>
          </div>
          <div class="encryption-step">
            <div class="step-icon" id="step2">
              <i class="fas fa-key"></i>
            </div>
            <div class="step-label">Generating Keys</div>
          </div>
          <div class="encryption-step">
            <div class="step-icon" id="step3">
              <i class="fas fa-lock"></i>
            </div>
            <div class="step-label">Encrypting</div>
          </div>
          <div class="encryption-step">
            <div class="step-icon" id="step4">
              <i class="fas fa-cloud"></i>
            </div>
            <div class="step-label">Storing</div>
          </div>
        </div>
      </div>

      <!-- Flash messages -->
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="alert alert-info">
            {% for msg in messages %}
              <p class="mb-0"><i class="fas fa-info-circle me-2"></i>{{ msg }}</p>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- File list -->
      <div class="file-list">
        <h4 class="mb-3"><i class="fas fa-folder me-2"></i>Your Encrypted Files</h4>

        {% if files %}
          {% for file in files %}
            <div class="file-item">
              <div class="file-info">
                <i class="fas fa-file file-icon"></i>
                <span class="file-name">{{ file }}</span>
              </div>
              <div class="file-actions">
                <a href="{{ url_for('download_file', filename=file) }}" class="btn btn-success downloadBtn">
                  <i class="fas fa-download me-1"></i>Download & Decrypt
                </a>
                <!-- Download spinner -->
                <div class="spinner-overlay">
                  <div class="spinner-border text-success" role="status"></div>
                </div>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="empty-state">
            <i class="fas fa-cloud"></i>
            <h4>No files yet</h4>
            <p>Upload your first file to get started</p>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>SecureCloud &copy; 2023 | Your files are protected with military-grade encryption</p>
    </div>
  </div>

  <script>
    const uploadForm = document.getElementById('uploadForm');
    const fileInput = document.getElementById('fileInput');
    const fileName = document.getElementById('fileName');
    const uploadArea = document.getElementById('uploadArea');
    const encryptionAnimation = document.getElementById('encryptionAnimation');
    const encryptionStatus = document.getElementById('encryptionStatus');
    const encryptionProgressBar = document.getElementById('encryptionProgressBar');
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const step4 = document.getElementById('step4');

    // File input change handler
    fileInput.addEventListener('change', function() {
      if (this.files.length > 0) {
        fileName.innerHTML = `<i class="fas fa-file me-2"></i><strong>Selected:</strong> ${this.files[0].name}`;

        // Show encryption animation
        showEncryptionAnimation();

        // Auto-submit the form when a file is selected
        setTimeout(() => {
          uploadForm.submit();
        }, 500);
      }
    });

    // Show encryption animation with steps
    function showEncryptionAnimation() {
      encryptionAnimation.classList.add('active');
      encryptionProgressBar.style.width = '0%';

      // Reset steps
      [step1, step2, step3, step4].forEach(step => step.classList.remove('active'));

      // Simulate encryption process
      setTimeout(() => {
        step1.classList.add('active');
        encryptionStatus.textContent = 'Uploading file to server...';
        encryptionProgressBar.style.width = '25%';
      }, 500);

      setTimeout(() => {
        step2.classList.add('active');
        encryptionStatus.textContent = 'Generating encryption keys...';
        encryptionProgressBar.style.width = '50%';
      }, 2000);

      setTimeout(() => {
        step3.classList.add('active');
        encryptionStatus.textContent = 'Encrypting file with AES-256...';
        encryptionProgressBar.style.width = '75%';
      }, 3500);

      setTimeout(() => {
        step4.classList.add('active');
        encryptionStatus.textContent = 'Storing encrypted file in cloud...';
        encryptionProgressBar.style.width = '100%';
      }, 5000);
    }

    // Drag and drop functionality
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = 'var(--primary)';
      uploadArea.style.backgroundColor = '#f0f5ff';
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.style.borderColor = 'var(--light-gray)';
      uploadArea.style.backgroundColor = '#fafbfc';
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = 'var(--light-gray)';
      uploadArea.style.backgroundColor = '#fafbfc';

      if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        fileName.innerHTML = `<i class="fas fa-file me-2"></i><strong>Selected:</strong> ${e.dataTransfer.files[0].name}`;

        // Show encryption animation
        showEncryptionAnimation();

        // Submit form after a short delay to let user see the animation
        setTimeout(() => {
          uploadForm.submit();
        }, 500);
      }
    });

    // Download spinners
    document.querySelectorAll('.downloadBtn').forEach((btn) => {
      btn.addEventListener('click', async (e) => {
        e.preventDefault(); // prevent default navigation
        const spinner = btn.nextElementSibling;
        const originalText = btn.innerHTML;

        // Show spinner and change button text
        spinner.classList.add('active');
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Decrypting...';
        btn.disabled = true;

        const downloadUrl = btn.href;

        try {
          const response = await fetch(downloadUrl);
          if (!response.ok) throw new Error('Download failed');

          const blob = await response.blob();
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = btn.closest('.file-item').querySelector('.file-name').innerText;
          document.body.appendChild(a);
          a.click();
          a.remove();
        } catch (err) {
          alert('Download failed: ' + err.message);
        } finally {
          // Restore button state
          spinner.classList.remove('active');
          btn.innerHTML = originalText;
          btn.disabled = false;
        }
      });
    });
  </script>
</body>
</html>